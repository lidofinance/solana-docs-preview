"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[9364],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>h});var o=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=o.createContext({}),c=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=c(e.components);return o.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=c(n),h=r,m=d["".concat(s,".").concat(h)]||d[h]||u[h]||a;return n?o.createElement(m,i(i({ref:t},p),{},{components:n})):o.createElement(m,i({ref:t},p))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,i=new Array(a);i[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var c=2;c<a;c++)i[c]=n[c];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}d.displayName="MDXCreateElement"},5688:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>u,frontMatter:()=>a,metadata:()=>l,toc:()=>c});var o=n(7462),r=(n(7294),n(3905));const a={},i="Price oracle",l={unversionedId:"development/price-oracle",id:"development/price-oracle",title:"Price oracle",description:"At its core, Lido on Solana (\u201cSolido\u201d for short) enables converting SOL into",source:"@site/docs/development/price-oracle.md",sourceDirName:"development",slug:"/development/price-oracle",permalink:"/development/price-oracle",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"solidoSidebar",previous:{title:"dockerimage",permalink:"/development/building-docker-image"},next:{title:"Reproducibility",permalink:"/development/reproducibility"}},s={},c=[{value:"On-chain",id:"on-chain",level:2},{value:"HTTP API",id:"http-api",level:2},{value:"Prometheus",id:"prometheus",level:2}],p={toc:c};function u(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,o.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"price-oracle"},"Price oracle"),(0,r.kt)("p",null,"At its core, Lido on Solana (\u201cSolido\u201d for short) enables converting SOL into\nstSOL and back. This conversion involves an exchange rate. The exchange rate\nused by Solido is stored on-chain in the Solido instance itself. This page\nexplains how to access it. To understand how the exchange rate is set, see ",(0,r.kt)("a",{parentName:"p",href:"../internals/exchange-rate"},"the\ninternals page about the exchange rate"),"."),(0,r.kt)("h2",{id:"on-chain"},"On-chain"),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"The details in this section are based on v1.0.0 of the Solido program. Please\nconfirm that this information is still up to date before building on it. The\nsource code is always the source of truth. For v1.0.0, the relevant field\nis ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/ChorusOne/solido/blob/v1.0.0/program/src/state.rs#L201"},(0,r.kt)("inlineCode",{parentName:"a"},"Lido::exchange_rate")),".")),(0,r.kt)("p",null,"Solido stores two values that together determine the exchange rate:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The amount of stSOL in existence, ",(0,r.kt)("inlineCode",{parentName:"li"},"st_sol_supply"),"."),(0,r.kt)("li",{parentName:"ul"},"The amount of SOL managed, ",(0,r.kt)("inlineCode",{parentName:"li"},"sol_balance"),".")),(0,r.kt)("p",null,"Both are represented as a little-endian ",(0,r.kt)("inlineCode",{parentName:"p"},"u64")," that holds the number of lamports.\n",(0,r.kt)("inlineCode",{parentName:"p"},"st_sol_supply")," is stored in in the Solido account data at byte 73..81,\nand ",(0,r.kt)("inlineCode",{parentName:"p"},"sol_balance")," is stored at byte 81..89. The address of the official Solido\ninstance is listed ",(0,r.kt)("a",{parentName:"p",href:"../deployments"},"on the deployments page"),"."),(0,r.kt)("p",null,"Byte 0 of the Solido account data is a version byte. If we make changes to the\ndata layout of the Solido account, we will bump the value of this byte. You can\nuse this to block transactions after we update Solido, to prevent reading\ngarbage data."),(0,r.kt)("p",null,"To extract the on-chain data, you can use the following libraries:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Rust"),": ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/ChorusOne/solido/tree/v1.0.0/program"},"The ",(0,r.kt)("inlineCode",{parentName:"a"},"solido")," crate")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Typescript"),": A library is in progress, follow ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/ChorusOne/solido/issues/467"},"this issue")," for details."),(0,r.kt)("li",{parentName:"ul"},"If you are interested in other ways to extract the on-chain data, feel free\nto ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/ChorusOne/solido/issues/new"},"open an issue")," and we might be able to help you out.")),(0,r.kt)("h2",{id:"http-api"},"HTTP API"),(0,r.kt)("p",null,"At the moment we do not expose a stable http API for requesting the current\nexchange rate, but we might support one if there is demand for it. Feel free\nto ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/ChorusOne/solido/issues/new"},"open an issue")," if you are interested."),(0,r.kt)("h2",{id:"prometheus"},"Prometheus"),(0,r.kt)("p",null,"The ",(0,r.kt)("a",{parentName:"p",href:"../operation/maintenance"},"maintenance daemon")," exposes details about the\nSolido instance at a Prometheus ",(0,r.kt)("inlineCode",{parentName:"p"},"/metrics")," endpoint. These metrics include\nSolido\u2019s current exchange rate. You will need to run an instance of the\nmaintenance daemon yourself to access these metrics; the endpoint is not\nintended to be exposed to the public internet."))}u.isMDXComponent=!0}}]);